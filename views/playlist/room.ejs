<!DOCTYPE html>
<html>

<head>
    <title>DubJube</title>
    <link rel="stylesheet" href="/stylesheets/style.css" />
</head>

<body>

    <h1>
        <%= playlist.name %>
    </h1>

    <div id="player"></div>

    <div id="buttons">
        <form action="/playlist/room/<%= playlist.id%>/addSong" method="POST">
            <input id="query" name="searchQuery" type="text" />
            <button id="search-button">Search</button>
        </form>
    </div>
    <% if (playlist.songs.length > 0) { %>

        <input type="hidden" id="first-song" value="<%= playlist.songs[0].id %>">
        <input type="hidden" id="playlistId" value="<%= playlist.id %>">

        <% } %>

            <% if(playlist.songs === []){ %>
                <p>Empty playlist</p>
                <% }else{ %>
                    <ul>
                        <% playlist.songs.forEach((song) =>{ %>
                            <li>
                                <%= song.title %>
                                    <img src="<%= song.thumbnail %>">
                            </li>
                            <% }); %>
                    </ul>
                    <% } %>







                        <script src="https://apis.google.com/js/client.js?onload=googleApiClientReady"></script>
                        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
                        <script src="/javascripts/auth.js"></script>
                        <!-- <script src="/javascripts/yt.js"></script> -->
                        <script src="/javascripts/search.js"></script>
                        <script src="https://apis.google.com/js/client.js?onload=init"></script>
                        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.17.1/axios.min.js"></script>
                        <script>
                            const firstSongId = document.getElementById("first-song");
                            const playlistId = document.getElementById("playlistId");
                            axios.get()
                            var tag = document.createElement("script");
                            tag.src = "https://www.youtube.com/iframe_api";
                            var firstScriptTag = document.getElementsByTagName("script")[0];
                            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
                            // 3. This function creates an <iframe> (and YouTube player)
                            //    after the API code downloads.
                            var player;

                            function onYouTubeIframeAPIReady() {
                                player = new YT.Player("player", {
                                    height: "360",
                                    width: "640",
                                    videoId: firstSongId.value,
                                    events: {
                                        onReady: onPlayerReady,
                                        onStateChange: onPlayerStateChange
                                    }
                                });
                            }
                            // 4. The API will call this function when the video player is ready.
                            function onPlayerReady(event) {
                                event.target.playVideo();
                            }
                            // when video ends
                            function onPlayerStateChange(event) {
                                if (event.data === 0) {
                                    // playlistId.value._id.pop();
                                    axios.post(`/playlist/room/${playlistId.value}`)
                                    // .then(function (response) {
                                    //     playlist.songs.pop();
                                    //     response.redirect(`/playlist/room/${playlistId.value}`)
                                    // })
                                    // .catch(function (error) {
                                    //     console.log(error);
                                    // });

                                }
                            }
                        </script>
</body>

</html>